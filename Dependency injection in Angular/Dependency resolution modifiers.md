Что это?

Модификаторы разрешения - это особые декораторы, которые влияют на то, как происходит проход по дереву инжекторов и какой из них в итоге будет отвечать за внедрение зависимостей в компоненты. Существуют следующие декораторы: Optional, Self, SkipSelf, Host

@Optional

Декоратор Optional делает экземпляр сервиса в компоненте не обязательным. Для демонстрации создадим сервис Logger и уберем регистрацию в рутовом модуле путем удаления свойства providedIn в декораторе Injectable
![[Pasted image 20230425102522.png]]
теперь внедрим данный сервис в компонент
![[Pasted image 20230425102641.png]]
при попытке получения экземпляра данного сервиса мы получим ошибку NullIjector, т.к не существует инжектора, где данный сервис был бы зарегистрирован
![[Pasted image 20230425102806.png]]
Добавим декоратор Optional к данному сервису
![[Pasted image 20230425102903.png]]
В таком случае приложение стартанет и в компоненте можно добавить логику, которая будет основываться на наличии или отсутствии данного метода.

@Self

Декоратор Self добавляет следующее поведение - зависимость будет внедрена только в том случае, если она добавлена в провайдеры самого компонента
![[Pasted image 20230425103407.png]]

если же данной зависимости нет в провайдерах компонента, то не будут проверяться инжекторы родительских компонентов, а так же модульные инжекторы, сразу будет получена ошибка NullInjector.
Особенностью данного декоратора является то, что при его использовании создается отдельный инстанс данной зависимости.
Для демонстрации данной особенности созданим поле prefix, которое по дефолту равно root![[Pasted image 20230425104056.png]]
и изменим данный префикс в компоненте![[Pasted image 20230425104141.png]]
теперь, если запустим приложение, то увидим, что данный префикс будет изменен![[Pasted image 20230425104253.png]]

@SkipSelf()

Данный декоратор делает противоположное действие - пропукает свой собственный инжектор и делегирует проверку ижектора родителю. Дальше проверка инжекторов происходит по обычному сценарию - сначала инжекторы элементов, затем инжекторы модулей.

@Host()

Хост декоратор позволяет ограничить скоуп, в котором будет использоваться та или иная зависимость. Создадим две директивы Parent и Child
![[Pasted image 20230502091547.png]]
добавим зависимость в Parent и сделаем ее опциональной, чтобы не сломалось приложение в случае удаление провайдеров.
![[Pasted image 20230502091653.png]]
так же добавим зависимость в Child директиву и продекорируем ее с помощью Host.
![[Pasted image 20230502091750.png]]
В таком случае все работает как и ожидалось, необходимый инжектор не находится в ChildDirective, но находится в Parent.
Теперь уберем провайдер из ParentDirective![[Pasted image 20230502091936.png]]
![[Pasted image 20230502091951.png]]
И мы получаем ошибку. Объясняется это тем, что декоратор Host добавляет ограничение к разрешению зависимости и ограничивает скоуп данного разрешения до хост-элемента. В данном случае таким элементом является директива ParentDirective.